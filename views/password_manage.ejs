<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PassX - Your Personal Password Manager</title>
    <link rel="stylesheet" href="password-style.css">
</head>
<body>
    <nav>
        <div class="logo">PassX</div>
        <ul>
            <li>Home</li>
            <li>About</li>
            <li>Contact</li>
        </ul>
    </nav>
    <div class="container">
        <h1>Password Manager</h1>
        <p>We're thrilled to have you here. Your digital life contains a myriad of passwords, and we know how
            challenging it can be to manage them all. That's why we're here to make it easy for you.</p>
        <h2>Your Passwords <span id="alert">(Copied!)</span></h2>
        <table>
            <tr>
                <th>Website</th>
                <th>Username</th>
                <th>Password</th>
                <th>Delete</th>
            </tr>

        </table>

        <h2>Add a Password</h2>
        <form id="passwordForm" action="/submit" method="post">

            <!-- Text input for website with validation -->
            <label for="website">Website:</label>
            <input type="text" id="website" name="website" pattern="^(https?|ftp)://[^\s/$.?#]+\.(com)$" title="Please enter a valid website URL ending with .com" required>
            <br><br>

            <!-- Text input for username -->
            <label for="username">Username:</label>
            <input type="text" id="username" name="username" required>
            <br><br>

            <!-- Password input with validation -->
            <label for="password">Password:</label>
            <input type="password" id="password" name="password" pattern="^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[a-zA-Z]).{8,}$" title="Password must be at least 8 characters long and contain at least one number, one uppercase letter, and one lowercase letter" required>
            <br>
            <!-- Submit button -->
            <button class="btn" type="submit">Submit</button>
        </form>
        <button class="btn" id="showDetailsBtn">See My Details</button>
        <div id="detailsContainer" style="display: none;">
            <h2>Your Details</h2>
            <div id="details"></div>
        </div>
    </div>
    <script>
        function maskPassword(pass) {
            let str = "";
            for (let index = 0; index < pass.length; index++) {
                str += "*";
            }
            return str;
        }

        function copyText(txt) {
            navigator.clipboard.writeText(txt).then(
                () => {
                    /* clipboard successfully set */
                    document.getElementById("alert").style.display = "inline";
                    setTimeout(() => {
                        document.getElementById("alert").style.display = "none";
                    }, 2000);

                },
                () => {
                    /* clipboard write failed */
                    alert("Clipboard copying failed");
                },
            );
        }

        const deletePassword = (website) => {
            let data = localStorage.getItem("passwords");
            let arr = JSON.parse(data);
            arrUpdated = arr.filter((e) => {
                return e.website != website;
            });
            localStorage.setItem("passwords", JSON.stringify(arrUpdated));
            alert(`Successfully deleted ${website}'s password`);
            showPasswords();
        };

        // Logic to fill the table
        const showPasswords = () => {
            let tb = document.querySelector("table");
            let data = localStorage.getItem("passwords");
            if (data == null || JSON.parse(data).length == 0) {
                tb.innerHTML = "No Data To Show";
            }
            else {
                tb.innerHTML = `<tr>
            <th>Website</th>
            <th>Username</th>
            <th>Password</th>
            <th>Delete</th>
        </tr>`;
                let arr = JSON.parse(data);
                let str = "";
                for (let index = 0; index < arr.length; index++) {
                    const element = arr[index];

                    str += `<tr>
        <td>${element.website} <img onclick="copyText('${element.website}')" src="./copy(1).png" alt="Copy Button" width="10" width="10" height="10">
        </td>
        <td>${element.username} <img onclick="copyText('${element.username}')" src="./copy(1).png" alt="Copy Button" width="10" width="10" height="10">
        </td>
        <td>${maskPassword(element.password)} <img onclick="copyText('${element.password}')" src="./copy(1).png" alt="Copy Button" width="10" width="10" height="10">
        </td>
        <td><button class="btnsm" onclick="deletePassword('${element.website}')">Delete</button></td>
            </tr>`;
                }
                tb.innerHTML = tb.innerHTML + str;

            }
            website.value = "";
            username.value = "";
            password.value = "";
        };

        console.log("Working");
        showPasswords();
        document.getElementById("passwordForm").addEventListener("submit", (e) => {
            e.preventDefault();
            console.log("Clicked....");
            console.log(username.value, password.value);
            let passwords = localStorage.getItem("passwords");
            console.log(passwords);
            if (passwords == null) {
                let json = [];
                json.push({ website: website.value, username: username.value, password: password.value });
                alert("Password Saved");
                localStorage.setItem("passwords", JSON.stringify(json));
            }
            else {
                let json = JSON.parse(localStorage.getItem("passwords"));
                json.push({ website: website.value, username: username.value, password: password.value });
                alert("Password Saved");
                localStorage.setItem("passwords", JSON.stringify(json));
            }
            showPasswords();
        });

        // Function to display user details
        document.getElementById("showDetailsBtn").addEventListener("click", () => {
            const data = JSON.parse(localStorage.getItem("passwords"));
            const detailsContainer = document.getElementById("detailsContainer");
            const detailsDiv = document.getElementById("details");

            if (data && data.length > 0) {
                detailsDiv.innerHTML = "";
                data.forEach(item => {
                    const { website, username, password } = item;
                    const detailParagraph = document.createElement("p");
                    detailParagraph.textContent = `Website: ${website}, Username: ${username}, Password: ${password}`;
                    detailsDiv.appendChild(detailParagraph);
                });
                detailsContainer.style.display = "block";
            } else {
                alert("No details found.");
            }
        });
    </script>
</body>
</html>
